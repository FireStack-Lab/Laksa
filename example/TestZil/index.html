<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <title></title>
  </head>
  <style>
    #nodeUrl,
    #address {
      width: 250px;
      height: 50px;
      font-size: 16px;
    }

    #setProviderButton,
    #getBlanceButton {
      width: 100px;
      height: 50px;
      margin-left: 16px;
      background: rgba(0, 0, 0, 1);
      color: #ffffff;
    }
  </style>

  <body>
    <div id="root">
      <h1>
        This is Laksa.js simple example, load this html in latest chrome please
      </h1>

      <h3>Current Provider is:</h3>
      <h4 id="currentProvider"></h4>
      <input id="nodeUrl" type="text" value="https://api-scilla.zilliqa.com" />
      <button id="setProviderButton">Set Provider</button>
      <h3>Input address, and get balance of it</h3>
      <input id="address" type="text" />
      <button id="getBlanceButton">Get Balance</button>
      <div>
        <span>balance:</span><span id="balance"></span> <span>nonce:</span
        ><span id="nonce"></span>
      </div>
    </div>
    <script src="../../dist/Laksa.browser.js"></script>
    <script>
      const laksa = new Laksa()
      const nodeProvider = new laksa.Modules.HttpProvider(
        'https://api-scilla.zilliqa.com'
      )
      const scillaProvider = new laksa.Modules.HttpProvider(
        'https://scilla-runner.zilliqa.com'
      )
      laksa.setNodeProvider(nodeProvider)
      laksa.setScillaProvider(scillaProvider)

      function callback(err, data) {
        console.log({ err, data })
      }

      const transaction = new laksa.Modules.Transaction({
        version: 0,
        toAddr: '2105d34aa4cbc67b40e649d4aad7d237d717668c',
        amount: laksa.util.toBN(5),
        gasPrice: laksa.util.toBN(1),
        gasLimit: laksa.util.toBN(10)
      })

      const accountA = laksa.wallet.importAccountFromPrivateKey(
        '3375F915F3F9AE35E6B301B7670F53AD1A5BE15D8221EC7FD5E503F21D3450C8'
      )

      const code = `(* HelloWorld contract *)
            
            import ListUtils
            
            (***************************************************)
            (*               Associated library                *)
            (***************************************************)
            library HelloWorld
            
            let one_msg = 
              fun (msg : Message) => 
              let nil_msg = Nil {Message} in
              Cons {Message} msg nil_msg
            
            let not_owner_code = Int32 1
            let set_hello_code = Int32 2
            
            (***************************************************)
            (*             The contract definition             *)
            (***************************************************)
            
            contract HelloWorld
            (owner: ByStr20)
            
            field welcome_msg : String = ""
            
            transition setHello (msg : String)
              is_owner = builtin eq owner _sender;
              match is_owner with
              | False =>
                msg = {_tag : "Main"; _recipient : _sender; _amount : Uint128 0; code : not_owner_code};
                msgs = one_msg msg;
                send msgs
              | True =>
                welcome_msg := msg;
                msg = {_tag : "Main"; _recipient : _sender; _amount : Uint128 0; code : set_hello_code};
                msgs = one_msg msg;
                send msgs
              end
            end
            
            
            transition getHello ()
                r <- welcome_msg;
                msg = {_tag : "Main"; _recipient : _sender; _amount : Uint128 0; msg : r};
                msgs = one_msg msg;
                send msgs
            end`

      const init = [
        {
          vname: 'owner',
          type: 'ByStr20',
          value: '0x8254b2c9acdf181d5d6796d63320fbb20d4edd12'
        }
      ]

      const transaction2 = new laksa.Modules.Transaction({
        version: 0,
        toAddr: '0000000000000000000000000000000000000000',
        amount: laksa.util.toBN(0),
        gasPrice: laksa.util.toBN(1),
        gasLimit: laksa.util.toBN(2500),
        code: code,
        data: JSON.stringify(init).replace(/\\"/g, '"')
      })

      const contract = laksa.contracts
        .new(code, ['0x8254b2c9acdf181d5d6796d63320fbb20d4edd12'])
        .then(d =>
          laksa.contracts.deploy(
            { contract: d, gasLimit: 2500, gasPrice: 1 },
            { signer: accountA }
          )
        )
        .then(console.log)
      console.log(transaction2)

      // accountA.signTransaction(transaction2)
      // .then(d=>laksa.zil.createTransaction(d))
      // .then(console.log)
    </script>
  </body>
</html>
